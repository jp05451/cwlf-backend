<!DOCTYPE html>
<html lang="en">
<head>
    <title>Welcome</title>
</head>
<body>
    <header>
        <h1>Welcome to Our Website!</h1>
    </header>
    <main>
        <p>We are glad to have you here. Explore and enjoy your stay!</p>
        <div class="upload-section">
            <input type="file" id="fileInput" accept="*/*">
            <button id="uploadBtn">Upload File</button>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="statusMessage" class="status-message"></div>
        </div>

        <style>
            .upload-section {
                margin: 20px 0;
                padding: 20px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
            
            #fileInput {
                margin-bottom: 10px;
                padding: 5px;
            }
            
            #uploadBtn {
                background-color: #007bff;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin-left: 10px;
            }
            
            #uploadBtn:hover {
                background-color: #0056b3;
            }
            
            .progress-container {
                width: 100%;
                height: 20px;
                background-color: #f0f0f0;
                border-radius: 10px;
                margin: 10px 0;
                overflow: hidden;
            }
            
            .progress-bar {
                height: 100%;
                background-color: #28a745;
                width: 0%;
                text-align: center;
                line-height: 20px;
                color: white;
                transition: width 0.3s ease;
            }
            
            .status-message {
                margin-top: 10px;
                padding: 10px;
                border-radius: 4px;
            }
            
            .status-message.success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            
            .status-message.error {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
        </style>
        <!-- <script src="{{ url_for('static', filename='uploadFile.js') }}"></script> -->
        <script>
            // File upload functionality
            document.addEventListener('DOMContentLoaded', function() {
                const fileInput = document.getElementById('fileInput');
                const uploadBtn = document.getElementById('uploadBtn');
                const progressBar = document.getElementById('progressBar');
                const statusMessage = document.getElementById('statusMessage');

                uploadBtn.addEventListener('click', function() {
                    const file = fileInput.files[0];
                    if (!file) {
                        statusMessage.textContent = 'Please select a file first';
                        return;
                    }
                    const formData = new FormData();
                    formData.append('file', file);
                    const xhr = new XMLHttpRequest();
                    xhr.upload.addEventListener('progress', function(e) {
                        if (e.lengthComputable) {
                            const percentComplete = (e.loaded / e.total) * 100;
                            progressBar.style.width = percentComplete + '%';
                            progressBar.textContent = Math.round(percentComplete) + '%';
                        }
                    });
                    xhr.addEventListener('load', function() {
                        if (xhr.status === 200) {
                            statusMessage.textContent = 'File uploaded successfully! 處理中...';
                            statusMessage.className = 'success';
                            progressBar.style.width = '0%';
                            // 檔案上傳成功後，呼叫後端進行資料處理
                            processUploadedFile(JSON.parse(xhr.responseText).filename);
                        } else {
                            statusMessage.textContent = 'Upload failed: ' + xhr.statusText;
                            statusMessage.className = 'error';
                            progressBar.style.width = '0%';
                        }
                    });
                    xhr.addEventListener('error', function() {
                        statusMessage.textContent = 'Upload error occurred';
                        statusMessage.className = 'error';
                        progressBar.style.width = '0%';
                    });
                    xhr.open('POST', '/upload');
                    xhr.send(formData);
                    statusMessage.textContent = 'Uploading...';
                    statusMessage.className = '';
                });

                function processUploadedFile(filename) {
                    statusMessage.textContent = '正在處理資料...';
                    statusMessage.className = '';
                    fetch('/process_uploaded_file', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ filename })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            statusMessage.textContent = '資料處理完成！';
                            statusMessage.className = 'success';
                        } else {
                            statusMessage.textContent = '資料處理失敗: ' + (data.error || '未知錯誤');
                            statusMessage.className = 'error';
                        }
                    })
                    .catch(err => {
                        statusMessage.textContent = '資料處理時發生錯誤';
                        statusMessage.className = 'error';
                    });
                }
            });
        </script>
    </main>
    <footer>
        <p>&copy; 2025 cwlf tcross project. All rights reserved.</p>
    </footer>
</body>
</html>