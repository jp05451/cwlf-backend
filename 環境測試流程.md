### **兒福聯盟後端系統 - 環境監控報告流程**

**版本**: 1.0
**日期**: 2025-08-06
**撰寫人**: 葉宜修

#### **1. 監控目標**
本監控流程旨在確保「兒福聯盟後端系統」所有服務的可用性 (Availability) 與健康狀況 (Health)，並在服務異常時提供明確的偵測與處理步驟。

#### **2. 自動化健康檢查 (Automated Health Checks)**
本系統內建了由 Docker 提供的自動化健康檢查機制，作為第一道防線。

**2.1. 檢查機制**
| 服務 | 健康檢查指令 | 檢查間隔 | 說明 |
| :--- | :--- | :--- | :--- |
| `app` | `curl -f http://localhost:3000/health` | 30秒 | 檢查 API 是否可訪問，且後端依賴 (DB, MQ) 是否正常。 |
| `mysql_db` | `mysqladmin ping -h localhost` | 10秒 | 檢查 MySQL 服務是否已啟動並可接受連線。 |
| `rabbitmq` | `rabbitmq-diagnostics check_port_connectivity`| 10秒 | 檢查 RabbitMQ 的主要服務端口是否已開啟。 |

**2.2. 狀態回報**
維運人員可隨時透過以下指令查詢所有服務的即時健康狀況：
```bash
docker compose ps
```
預期的正常狀態為 `(healthy)`。若出現 `(unhealthy)`，代表該服務可能已發生問題。

#### **3. 手動監控與問題排查流程**

**3.1. 第一步：確認容器狀態**
*   **指令**: `docker compose ps`
*   **目的**: 快速檢視哪個容器出現 `unhealthy` 或 `Exited` 狀態。

**3.2. 第二步：檢查日誌 (Logging)**
*   **指令**: `docker compose logs [服務名稱]` (例如: `docker compose logs app`)
*   **目的**: 深入分析指定服務的日誌輸出，查找錯誤訊息 (ERROR)、堆疊追蹤 (stack traces) 或異常行為。這是定位問題根源最重要的一步。

**3.3. 第三步：訪問服務端點**
*   **應用程式 (`app`)**:
    *   **健康端點**: `curl http://localhost:3000/health` (或在瀏覽器訪問)
    *   **目的**: 驗證 API 層是否正常，以及其後端依賴的連線狀態。
*   **RabbitMQ 管理介面**:
    *   **網址**: `http://localhost:15672`
    *   **目的**: 登入後可圖形化地查看連線、通道、佇列等詳細狀態。

#### **4. 資料備份與告警**

**4.1. 自動化備份**
*   **機制**: 透過主機的 `cron` 排程，每週日凌晨 3:30 自動執行 `backup.sh` 腳本。
*   **產出**: 備份檔案儲存於專案根目錄下的 `backups/` 資料夾中。
*   **監控點**: 維運人員應定期檢查該目錄下是否有新的備份檔案生成。

