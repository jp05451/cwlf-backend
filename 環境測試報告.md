### **兒福聯盟後端系統 - 環境測試報告**

**版本**: 1.0
**測試日期**: 2025-08-06
**測試人員**: 葉宜修

#### **1. 測試目的**
本次測試旨在驗證「兒福聯盟後端系統」UAT 環境的部署流程、健康檢查機制，以及核心的資料庫災難備援方案的有效性。

#### **2. 測試環境**
*   **作業系統**: Ubuntu 22.04 on WSL2
*   **Docker 版本**: 28.3.3
*   **Docker Compose 版本**: 2.39.1
*   **測試目標**: `cwlf-backend` 專案，使用 `docker-compose.yml` 與 `docker-compose.uat.yml` 進行部署。

#### **3. 測試案例與結果**

**3.1. 測試案例 1：UAT 環境部署測試**
*   **測試步驟**:
    1.  執行 `docker compose -f docker-compose.yml -f docker-compose.uat.yml up --build -d`。
    2.  執行 `docker ps` 確認所有容器 (`cwlf-app-uat`, `mysql-uat`, `rabbitmq-uat`) 均已啟動。
    3.  訪問 `http://localhost:8080` (UAT 的 app 連接埠)。
*   **預期結果**: 所有容器正常啟動，網頁應能成功訪問並顯示所有服務連線成功。
*   **實際結果**: ✅ **通過**。所有容器均正常啟動，網頁訪問成功，狀態顯示正常。

**3.2. 測試案例 2：自動健康檢查機制測試**
*   **測試步驟**:
    1.  在 UAT 環境正常運行時，執行 `docker stop mysql-uat`，手動模擬資料庫服務失效。
    2.  等待約 1 分鐘。
    3.  執行 `docker compose -f ... ps` 觀察 `app` 服務的狀態。
    4.  訪問 `http://localhost:8080/health`。
*   **預期結果**: `app` 服務的狀態應從 `(healthy)` 變為 `(unhealthy)`。訪問健康端點應回傳 HTTP 503 錯誤。
*   **實際結果**: ✅ **通過**。`app` 容器狀態成功變為 `unhealthy`，API 端點回傳 503 錯誤，證明健康檢查機制能有效偵測到後端依賴的故障。
*   **恢復步驟**: 執行 `docker start mysql-uat`，觀察到 `app` 狀態在稍後恢復為 `(healthy)`。

**3.3. 測試案例 3：資料庫災難備援方案測試**
*   **測試步驟**:
    1.  **準備**: 準備一份有效的資料庫備份檔 (例如 `backups/backup-xxxx.sql`)。
    2.  **模擬災難**: 停止並移除 UAT 環境 (`docker compose -f ... down`)，並手動執行 `docker volume rm cwlf-backend_mysql-data` 徹底刪除資料庫資料卷。
    3.  **執行還原**:
        a. 僅啟動資料庫服務 (`... up -d mysql-uat`)。
        b. 執行還原腳本 `./restore.sh ./backups/backup-xxxx.sql`。
    4.  **完整啟動**: 啟動完整的 UAT 環境 (`... up -d`)。
    5.  **驗證**: 訪問應用程式，檢查資料是否已恢復至備份時的狀態。
*   **預期結果**: 還原腳本應執行成功。完整環境啟動後，應用程式應能正常連線資料庫，且資料狀態與備份檔一致。
*   **實際結果**: ✅ **通過**。整個備援流程順利執行，資料庫成功從備份檔還原，系統恢復正常運作。

#### **4. 測試結論**
本次測試驗證了本系統的 UAT 環境部署流程清晰可行，自動健康檢查機制反應靈敏，核心的資料庫災難備援方案**有效且可靠**。系統已達到專案要求的穩定性與可維護性標準。